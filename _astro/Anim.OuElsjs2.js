import{r as I}from"./index.BVOCwoKb.js";var ne,re,Y={exports:{}},F={};function ge(){if(ne)return F;ne=1;var e=Symbol.for("react.transitional.element"),t=Symbol.for("react.fragment");function n(t,n,r){var a=null;if(void 0!==r&&(a=""+r),void 0!==n.key&&(a=""+n.key),"key"in n)for(var o in r={},n)"key"!==o&&(r[o]=n[o]);else r=n;return n=r.ref,{$$typeof:e,type:t,key:a,ref:void 0!==n?n:null,props:r}}return F.Fragment=t,F.jsx=n,F.jsxs=n,F}function pe(){return re||(re=1,Y.exports=ge()),Y.exports}var S=pe();const l=32,c=50,u=50,f=3,b=l*l,ue=Array.from({length:u},((e,t)=>new Float32Array(l).map(((e,n)=>Math.cos((2*t+1)*n*Math.PI/100))))),ie=Array.from({length:c},((e,t)=>new Float32Array(l).map(((e,n)=>Math.cos((2*t+1)*n*Math.PI/100)))));let g,$,ce,H,ae,oe,O,P,L=null,w=0,k=0;async function ve(e){return L||(L=(async()=>{if(!navigator.gpu)return null;const t=await navigator.gpu.requestAdapter();if(!t)return null;g=await t.requestDevice({requiredLimits:{maxTextureArrayLayers:e,maxStorageBufferBindingSize:2147483644,maxBufferSize:2147483648}});const n=e=>{const t=g.createBuffer({size:e.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});return new Float32Array(t.getMappedRange()).set(e),t.unmap(),t};ae=n(Float32Array.from({length:u*l},((e,t)=>ue[t/l|0][t%l]))),oe=n(Float32Array.from({length:c*l},((e,t)=>ie[t/l|0][t%l]))),H=g.createBuffer({size:3*e*b*4,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),k=e*c*u*3*4,O=g.createBuffer({size:k,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),P=g.createBuffer({size:k,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});const r=g.createShaderModule({code:`\n        struct Mat{data:array<f32>};\n        @group(0) @binding(0) var<storage,read>        coeff : Mat;\n        @group(0) @binding(1) var<storage,read>        cosU  : Mat;\n        @group(0) @binding(2) var<storage,read>        cosV  : Mat;\n        @group(0) @binding(3) var<storage,read_write>  outF  : array<f32>;\n\t\t\t\n        const W:u32=50; const H:u32=50; const L:u32=32; const F:u32=${e}; const C:u32=3;\n        const KSQ:u32=1024;\n\t\t\t\n        @compute @workgroup_size(16,16,1)\n        fn main(@builtin(global_invocation_id) gid:vec3<u32>) {\n          let x=gid.x; let y=gid.y; let bc=gid.z;           // block-channel index\n          if (x>=W || y>=H) { return; }\n\t\t\t\n          let frame = bc / C;                       // 0..F-1\n          let chan  = bc % C;                       // 0,1,2\n\t\t\t\n          var sum:f32 = 0.0;\n          for (var v:u32=0; v<L; v++){\n            let cv = cosV.data[y*L+v];\n            for (var u:u32=0; u<L; u++){\n              let cu = cosU.data[x*L+u];\n              sum += coeff.data[bc*KSQ + v*L + u] * cu * cv;\n            }\n          }\n          sum = clamp(sum,0.0,255.0);\n          let idx = ((frame*H + y)*W + x)*C + chan;\n          outF[idx] = sum;\n        }`});return $=g.createComputePipeline({layout:"auto",compute:{module:r,entryPoint:"main"}}),ce=g.createBindGroup({layout:$.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:H}},{binding:1,resource:{buffer:ae}},{binding:2,resource:{buffer:oe}},{binding:3,resource:{buffer:O}}]}),null})(),L)}async function he(e){if(!g)return null;g.queue.writeBuffer(H,0,e);const t=g.createCommandEncoder(),n=t.beginComputePass();n.setPipeline($),n.setBindGroup(0,ce),n.dispatchWorkgroups(Math.ceil(u/16),Math.ceil(c/16),3*w),n.end(),t.copyBufferToBuffer(O,0,P,0,k),g.queue.submit([t.finish()]),await g.queue.onSubmittedWorkDone(),await P.mapAsync(GPUMapMode.READ);const r=new Float32Array(P.getMappedRange()).slice();return P.unmap(),r}function xe(e){const t=new Float32Array(7500);for(let n=0;n<3;n++){const r=new Float32Array(e.subarray(n*b,(n+1)*b)),a=new Float32Array(l*u);for(let e=0;e<l;e++)for(let t=0;t<u;t++){let n=0,o=ue[t];for(let t=0;t<l;t++)n+=r[e*l+t]*o[t];a[e*u+t]=n}for(let e=0;e<c;e++)for(let r=0;r<u;r++){let o=0,s=ie[e];for(let e=0;e<l;e++)o+=a[e*u+r]*s[e];t[3*(e*u+r)+n]=o}}return t}let G=null;function ye(){return G||(G=(async()=>{const e=new Float16Array(await(await fetch("/assets/anim.bin")).arrayBuffer());if(w=e.length/b/3,!Number.isInteger(w))throw new Error("corrupt file size");await ve(w);const t=Float32Array.from(e);let n=await he(t);if(!n){n=new Float32Array(7500*w);for(let t=0;t<w;t++){const r=e.subarray(3*t*b,3*(t+1)*b);n.set(xe(r),t*c*u*3)}}const r=new Uint8ClampedArray(n.length);for(let e=0;e<n.length;e++)r[e]=255&n[e];return{bytes:r,frameCount:w}})(),G)}function Ae(e,t,n){e/=255,t/=255,n/=255;const r=Math.max(e,t,n),a=r-Math.min(e,t,n);let o=0;0!==a&&(o=r===e?(t-n)/a%6:r===t?(n-e)/a+2:(e-t)/a+4,o*=60,o<0&&(o+=360));return[o,0===r?0:a/r,r]}function we(e,t,n){const r=n*t,a=r*(1-Math.abs(e/60%2-1)),o=n-r;let u,s,i;return[u,s,i]=[r,a,0],[Math.round(255*(u+o)),Math.round(255*(s+o)),Math.round(255*(i+o))]}const be=40,Me=20,Ee=50;let se=0;function Re(e){const t=e.data;for(let e=0;e<t.length;e+=4){const n=t[e],r=t[e+1],a=t[e+2],[,o,u]=Ae(n,r,a),[s,i,c]=we(40,.5*o,.8*u);t[e]=s,t[e+1]=i,t[e+2]=c}return e}function Fe({isAbout:e=!1,isHome:t=!1}){const n=I.useRef(null),r=I.useRef(null);return e?S.jsx("div",{className:"animContainer lg:uno-desktop-column w-14em",children:S.jsx("img",{src:"/assets/images/headshot.jpg",className:"animCanvas",alt:"Decorative graphic"})}):(I.useEffect((()=>{const e=n.current;e.width=u,e.height=c;const a=e.getContext("2d"),o=document.createElement("canvas");o.width=u,o.height=c;const s=o.getContext("2d"),i=document.createElement("canvas");i.width=u,i.height=c;const l=i.getContext("2d"),f=a.createImageData(u,c);let g=!1,m=null,d=null,p=0,h=1,y=0,v=0,b=0;function w(e){const t=performance.now();if(null!==m){const n=Math.hypot(e.clientX-m,e.clientY-d)/((t-p)/1e3||1);h=1+Math.min(n/100,10)}m=e.clientX,d=e.clientY,p=t}const A=e=>{w(e),b=1},x=()=>{h=1,m=d=null,b=0};return e.addEventListener("mousemove",w),e.addEventListener("mouseenter",A),e.addEventListener("mouseleave",x),ye().then((({bytes:e,frameCount:n})=>{if(g)return;let m=0,d=performance.now();r.current=requestAnimationFrame((function g(w){if(w>=se){se=w+50;const r=w-d;d=w,p&&w-p>100&&(h=1),m=(m+.005*r*h)%n;const g=0|m,A=(g+1)%n,x=m-g;for(let t=0;t<c;++t)for(let n=0;n<u;++n){const r=7500*g+150*t+3*n,a=7500*A+150*t+3*n,o=4*(t*u+n);for(let t=0;t<3;++t)f.data[o+t]=e[r+t]*(1-x)+e[a+t]*x;f.data[o+3]=255}s.putImageData(f,0,0);const F=Re(new ImageData(Uint8ClampedArray.from(f.data),u,c));if(l.putImageData(t?f:F,0,0),v!==b){const e=Math.sign(b-v);v+=e*r*.005,(e>0&&v>b||e<0&&v<b)&&(v=b)}1!==y&&(y+=.3*r*.005,y<0&&(y=0),y>1&&(y=1)),a.clearRect(0,0,u,c),a.globalAlpha=y,a.drawImage(i,0,0),a.globalAlpha=y*v,a.drawImage(o,0,0),a.globalAlpha=1}r.current=requestAnimationFrame(g)}))})),()=>{g=!0,cancelAnimationFrame(r.current),e.removeEventListener("mouseenter",A),e.removeEventListener("mousemove",w),e.removeEventListener("mouseleave",x)}}),[]),S.jsx("div",{className:"animContainer lg:uno-desktop-column w-14em",children:S.jsx("canvas",{ref:n,width:u,height:c,className:"animCanvas"})}))}export{Fe as default};